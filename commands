import org.apache.poi.xwpf.usermodel.*;
import org.springframework.core.io.ClassPathResource;
import org.springframework.stereotype.Service;

import java.io.*;

@Service
public class DocumentMergeService {

    public void mergeDocuments(String outputFileName) throws IOException {
        // Load the documents from resources folder
        File doc1File = new ClassPathResource("doc1.docx").getFile();
        File doc2File = new ClassPathResource("doc2.docx").getFile();

        // Read both documents
        try (FileInputStream fis1 = new FileInputStream(doc1File);
             FileInputStream fis2 = new FileInputStream(doc2File);
             XWPFDocument doc1 = new XWPFDocument(fis1);
             XWPFDocument doc2 = new XWPFDocument(fis2)) {

            // Create a new document
            XWPFDocument mergedDoc = new XWPFDocument();

            // Append content from first document
            appendDocumentContent(doc1, mergedDoc);

            // Add a page break between documents
            mergedDoc.createParagraph().setPageBreak(true);

            // Append content from second document
            appendDocumentContent(doc2, mergedDoc);

            // Write the merged document
            try (FileOutputStream fos = new FileOutputStream(outputFileName)) {
                mergedDoc.write(fos);
            }
        }
    }

    private void appendDocumentContent(XWPFDocument source, XWPFDocument target) {
        for (XWPFParagraph paragraph : source.getParagraphs()) {
            XWPFParagraph newParagraph = target.createParagraph();
            newParagraph.getCTP().set(paragraph.getCTP().copy());
        }

        for (XWPFTable table : source.getTables()) {
            XWPFTable newTable = target.createTable();
            newTable.getCTTbl().set(table.getCTTbl().copy());
        }
    }
}
